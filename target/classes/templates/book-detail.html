<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${book.title} + ' - Online Book Store'">Book Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome@6.0.0/css/all.min.css" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body class="book-detail-page">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" th:href="@{/user/dashboard}">
                <i class="fas fa-book"></i> Online Book Store
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/user/dashboard}">
                            <i class="fas fa-home"></i> Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/books}">
                            <i class="fas fa-book-open"></i> Books
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/cart}">
                            <i class="fas fa-shopping-cart"></i> Cart
                            <span class="badge bg-warning ms-1" th:text="${cartItemCount}" th:if="${cartItemCount > 0}">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/wishlist}">
                            <i class="fas fa-heart"></i> Wishlist
                            <span class="badge bg-danger ms-1" th:text="${wishlistCount}" th:if="${wishlistCount > 0}">0</span>
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-warning" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user"></i> Hi, <span sec:authentication="name"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" th:href="@{/user/dashboard}">
                                <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/user/profile}">
                                <i class="fas fa-user-cog me-2"></i>My Profile
                            </a></li>
                            <li><a class="dropdown-item" th:href="@{/orders}">
                                <i class="fas fa-receipt me-2"></i>My Orders
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" th:href="@{/logout}">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5 pt-5">
        <div class="content-container">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a th:href="@{/user/dashboard}">Home</a></li>
                    <li class="breadcrumb-item"><a th:href="@{/books}">Books</a></li>
                    <li class="breadcrumb-item active" th:text="${book.title}">Book Title</li>
                </ol>
            </nav>

            <div class="row">
                <!-- Book Cover Section -->
                <div class="col-md-4 mb-4">
                    <div class="book-cover-section text-center">
                        <div class="book-image-placeholder p-5 rounded mb-4">
                            <i class="fas fa-book fa-6x text-white"></i>
                        </div>
                        
                        <!-- Rating Section -->
                        <div class="rating-section mb-3">
                            <div class="d-flex align-items-center justify-content-center mb-2">
                                <div class="text-warning me-2">
                                    <i class="fas fa-star" th:each="i : ${#numbers.sequence(1, 5)}" 
                                       th:class="${i <= averageRating ? 'fas fa-star' : (i <= averageRating + 0.5 ? 'fas fa-star-half-alt' : 'far fa-star')}"></i>
                                </div>
                                <span class="fw-bold" th:text="${#numbers.formatDecimal(averageRating, 1, 1)}">0.0</span>
                                <span class="text-muted ms-1" th:text="'(' + ${reviewCount} + ' reviews)'">(0 reviews)</span>
                            </div>
                        </div>

                        <!-- Wishlist Actions -->
                        <div class="wishlist-actions mb-4">
                            <form th:action="@{${inWishlist ? '/wishlist/remove' : '/wishlist/add'}}" method="post" class="d-inline">
                                <input type="hidden" name="bookId" th:value="${book.id}">
                                <button type="submit" class="btn" th:class="${inWishlist ? 'btn-danger' : 'btn-outline-danger'}">
                                    <i class="fas fa-heart me-2"></i>
                                    <span th:text="${inWishlist ? 'Remove from Wishlist' : 'Add to Wishlist'}">Add to Wishlist</span>
                                </button>
                            </form>
                        </div>

                        <div class="book-badges">
                            <span class="badge bg-success me-2" th:if="${book.stockQuantity > 0}">
                                <i class="fas fa-check"></i> In Stock
                            </span>
                            <span class="badge bg-danger" th:if="${book.stockQuantity <= 0}">
                                <i class="fas fa-times"></i> Out of Stock
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Book Details Section -->
                <div class="col-md-8">
                    <div class="book-details-section">
                        <h1 class="display-6 fw-bold text-primary mb-3" th:text="${book.title}">Book Title</h1>
                        <h4 class="text-muted mb-4" th:text="'by ' + ${book.author}">Author Name</h4>
                        
                        <!-- Book Meta Information -->
                        <div class="book-meta mb-4">
                            <div class="row">
                                <div class="col-sm-6 mb-3">
                                    <strong>Category:</strong>
                                    <span class="badge bg-secondary ms-2" th:text="${book.category ?: 'General'}">Category</span>
                                </div>
                                <div class="col-sm-6 mb-3">
                                    <strong>ISBN:</strong>
                                    <span class="ms-2 text-muted" th:text="${book.isbn}">ISBN Number</span>
                                </div>
                                <div class="col-sm-6 mb-3">
                                    <strong>Stock Available:</strong>
                                    <span class="ms-2" th:class="${book.stockQuantity > 0 ? 'text-success fw-bold' : 'text-danger fw-bold'}" 
                                          th:text="${book.stockQuantity}">0</span>
                                </div>
                                <div class="col-sm-6 mb-3">
                                    <strong>Added On:</strong>
                                    <span class="ms-2 text-muted" th:text="${#temporals.format(book.createdAt, 'MMMM dd, yyyy')}">Date</span>
                                </div>
                            </div>
                        </div>

                        <!-- Book Description -->
                        <div class="book-description mb-4">
                            <h5 class="fw-bold mb-3">About This Book</h5>
                            <p class="lead" th:text="${book.description}">Book description goes here. This section provides detailed information about the book's content, themes, and what readers can expect.</p>
                        </div>

                        <!-- Price and Purchase Section -->
                        <div class="purchase-section p-4 bg-light rounded">
                            <div class="row align-items-center">
                                <div class="col-md-6 mb-3 mb-md-0">
                                    <div class="price-section">
                                        <span class="text-muted">Price:</span>
                                        <span class="h2 text-primary fw-bold ms-2" th:text="'$' + ${book.price}">$0.00</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <form th:action="@{/cart/add}" method="post" class="d-flex align-items-center justify-content-md-end">
                                        <input type="hidden" name="bookId" th:value="${book.id}">
                                        <div class="me-3">
                                            <label for="quantity" class="form-label fw-bold">Quantity:</label>
                                            <input type="number" id="quantity" name="quantity" value="1" min="1" 
                                                   th:max="${book.stockQuantity}" class="form-control" style="width: 80px;">
                                        </div>
                                        <button type="submit" class="btn btn-primary btn-lg" 
                                                th:disabled="${book.stockQuantity <= 0}">
                                            <i class="fas fa-cart-plus me-2"></i> 
                                            <span th:text="${book.stockQuantity > 0 ? 'Add to Cart' : 'Out of Stock'}">Add to Cart</span>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reviews Section -->
                    <div class="reviews-section mt-5">
                        <h4 class="fw-bold mb-4">
                            <i class="fas fa-star me-2 text-warning"></i>
                            Customer Reviews
                            <small class="text-muted" th:text="'(' + ${reviewCount} + ' reviews)'">(0 reviews)</small>
                        </h4>

                        <!-- Add Review Form -->
                        <div class="card mb-4" th:unless="${userReview}">
                            <div class="card-header bg-light">
                                <h5 class="card-title mb-0">Write a Review</h5>
                            </div>
                            <div class="card-body">
                                <form th:action="@{/reviews/add}" method="post">
                                    <input type="hidden" name="bookId" th:value="${book.id}">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Your Rating</label>
                                        <div class="rating-input">
                                            <div class="btn-group" role="group">
                                                <input type="radio" class="btn-check" name="rating" id="rating1" value="1" required>
                                                <label class="btn btn-outline-warning" for="rating1">1</label>
                                                
                                                <input type="radio" class="btn-check" name="rating" id="rating2" value="2">
                                                <label class="btn btn-outline-warning" for="rating2">2</label>
                                                
                                                <input type="radio" class="btn-check" name="rating" id="rating3" value="3">
                                                <label class="btn btn-outline-warning" for="rating3">3</label>
                                                
                                                <input type="radio" class="btn-check" name="rating" id="rating4" value="4">
                                                <label class="btn btn-outline-warning" for="rating4">4</label>
                                                
                                                <input type="radio" class="btn-check" name="rating" id="rating5" value="5" checked>
                                                <label class="btn btn-outline-warning" for="rating5">5</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="comment" class="form-label fw-bold">Your Review</label>
                                        <textarea class="form-control" id="comment" name="comment" rows="3" 
                                                  placeholder="Share your thoughts about this book..." required></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Submit Review</button>
                                </form>
                            </div>
                        </div>

                        <!-- User's Existing Review -->
                        <div class="card mb-4" th:if="${userReview}">
                            <div class="card-header bg-light">
                                <h5 class="card-title mb-0">Your Review</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="text-warning me-2">
                                        <i class="fas fa-star" th:each="i : ${#numbers.sequence(1, 5)}" 
                                           th:class="${i <= userReview.rating ? 'fas fa-star' : 'far fa-star'}"></i>
                                    </div>
                                    <span class="fw-bold" th:text="'Rated ' + ${userReview.rating} + '/5'">Rated 5/5</span>
                                    <small class="text-muted ms-2" th:text="${#temporals.format(userReview.createdAt, 'MMM dd, yyyy')}">Jan 01, 2024</small>
                                </div>
                                <p class="mb-0" th:text="${userReview.comment}">Your review comment here...</p>
                            </div>
                        </div>

                        <!-- Other Reviews -->
                        <div th:each="review : ${reviews}" th:if="${review.user.username != currentUser.username}">
                            <div class="card mb-3">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <div>
                                            <h6 class="fw-bold mb-1" th:text="${review.user.username}">Username</h6>
                                            <div class="text-warning">
                                                <i class="fas fa-star" th:each="i : ${#numbers.sequence(1, 5)}" 
                                                   th:class="${i <= review.rating ? 'fas fa-star' : 'far fa-star'}"></i>
                                            </div>
                                        </div>
                                        <small class="text-muted" th:text="${#temporals.format(review.createdAt, 'MMM dd, yyyy')}">Jan 01, 2024</small>
                                    </div>
                                    <p class="mb-0" th:text="${review.comment}">Review comment here...</p>
                                </div>
                            </div>
                        </div>

                        <!-- No Reviews Message -->
                        <div th:if="${reviews.empty}" class="text-center py-4">
                            <i class="fas fa-comments fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No reviews yet. Be the first to review this book!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="row mt-4">
                <div class="col-12 text-center">
                    <a th:href="@{/books}" class="btn btn-outline-secondary me-3">
                        <i class="fas fa-arrow-left me-2"></i> Back to Books
                    </a>
                    <a th:href="@{/books}" class="btn btn-primary">
                        <i class="fas fa-book me-2"></i> Continue Shopping
                    </a>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-light mt-5 py-4">
        <div class="container text-center">
            <p>&copy; 2024 Online Book Store. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
